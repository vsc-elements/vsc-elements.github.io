---
import * as fs from "node:fs/promises";
import { Debug } from "astro:components";
import StarlightPage from "@astrojs/starlight/components/StarlightPage.astro";
import { Aside, Badge } from "@astrojs/starlight/components";
import { marked } from "marked";
import { getCustomElementDeclaration } from "./helpers";
import type {
  CustomElement,
  CustomElementField,
} from "custom-elements-manifest";
import Properties from "./Properties.astro";
import Methods from "./Methods.astro";

export type Props = {
  /** Custom Elements Manifest path */
  cemPath: string;
  tagName: string;
  title: string;
};

const { cemPath, tagName, title } = Astro.props;
const fc = await fs.readFile(cemPath, "utf-8");
const manifest = JSON.parse(fc);
const declaration = getCustomElementDeclaration(tagName, manifest);
---

<StarlightPage
  frontmatter={{ title: title }}
  headings={[
    { depth: 2, slug: "Properties", text: "Properties" },
    { depth: 2, slug: "Methods", text: "Methods" },
    { depth: 2, slug: "Events", text: "Events" },
    { depth: 2, slug: "Custom_CSS_Properties", text: "Custom CSS Properties" },
    { depth: 2, slug: "CSS_Parts", text: "CSS Parts" },
  ]}
>
  {
    declaration ? (
      <>
        {declaration.fields.length > 0 ? (
          <Properties items={declaration.fields} />
        ) : null}
        {declaration.fields.length > 0 ? (
          <Methods items={declaration.methods} />
        ) : null}
      </>
    ) : null
  }

  <Debug dec={declaration} />
</StarlightPage>
